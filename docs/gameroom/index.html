<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏实验室 | DawnTilDusk</title>
    <!-- 引入 Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入主样式表 (复用背景和基础风格) -->
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* 页面特定样式 */
        body {
            overflow: hidden; /* 防止滚动条出现 */
        }

        /* 游戏容器：占据剩余空间 */
        #game-playground {
            position: relative;
            width: 100%;
            height: calc(100vh - 180px); /* 减去Header和Footer的大致高度 */
            margin-top: 20px;
            /* 可选：给容器加一个极其微弱的边框或背景，让它看起来像个“池子” */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        /* 浮动方块样式 */
        .game-block {
            position: absolute;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7); /* 默认文字颜色较暗 */
            background: rgba(255, 255, 255, 0.05); /* 默认背景非常透明 */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(4px);
            transition: background 0.3s, color 0.3s, box-shadow 0.1s, transform 0.1s;
            cursor: pointer;
            user-select: none;
            text-align: center;
            padding: 10px;
        }

        .game-block i {
            font-size: 2rem;
            margin-bottom: 8px;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .game-block span {
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* 鼠标悬停效果 (用户主动交互) - 保持与其他高光时刻一致 */
        .game-block:hover {
            background: rgba(255, 255, 255, 0.3); /* 稍微更亮一点 */
            border-color: rgba(255, 255, 255, 0.8);
            color: white;
            z-index: 100; /* 确保在最上层 */
            /* transform 由 JS 控制 */
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.6); /* 强烈发光 */
        }

        .game-block:hover i {
            opacity: 1;
        }

        /* 碰撞发光效果 (JavaScript控制) */
        .game-block.hit-glow {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
            color: white;
        }

        /* 适配移动端 */
        @media (max-width: 768px) {
            .game-block {
                width: 90px;
                height: 90px;
            }
            .game-block i {
                font-size: 1.5rem;
            }
            .game-block span {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="container-inner">
                <nav>
                    <!-- Logo链接回主页 -->
                    <a href="../index.html" class="logo">DawnTilDusk | 游戏实验室</a>
                    <ul class="nav-links">
                        <!-- 保持导航一致性，当前页高亮或不可点 -->
                        <li><a href="#" style="color: #efe8cb; border-bottom: 2px solid #efe8cb;">Games</a></li>
                        <li><a href="#">002</a></li>
                        <li><a href="#" id="easterEgg">003</a></li>
                        <li><a href="#">004</a></li>
                        <li><a href="#">005</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <main>
            <!-- 游戏物理容器 -->
            <div id="game-playground">
                <!-- 方块将由JS动态生成 -->
            </div>
        </main>
    </div>

    <!-- 脚本逻辑 -->
    <script>
        // ================= 配置区域 =================
        // 在这里添加你的新游戏！
        const games = [
            {
                id: 'satire-runner',
                name: 'Satire Runner',
                icon: 'fa-person-running', // FontAwesome 图标名
                url: '../satire-runner/',   // 游戏链接
                color: '#4caf50'            // 暂时没用到，可用于特定发光色
            },
            // 示例：未来添加新游戏只需解开注释并修改
            /*
            {
                id: 'new-game',
                name: '超级新游戏',
                icon: 'fa-gamepad',
                url: '#',
                color: '#ff5722'
            },
            */
        ];
        // ===========================================

        const playground = document.getElementById('game-playground');
        const blocks = [];

        // 初始化游戏方块
        function initBlocks() {
            const containerRect = playground.getBoundingClientRect();
            
            games.forEach((game, index) => {
                const el = document.createElement('a');
                el.href = game.url;
                el.className = 'game-block';
                el.innerHTML = `<i class="fas ${game.icon}"></i><span>${game.name}</span>`;
                
                playground.appendChild(el);

                // 随机初始位置 (避免贴边)
                // 注意：el.offsetWidth 在添加到DOM后才可用
                const w = 120; // 估算宽度，或在下一帧获取
                const h = 120;
                const maxX = containerRect.width - w;
                const maxY = containerRect.height - h;

                const x = Math.random() * (maxX - 20) + 10;
                const y = Math.random() * (maxY - 20) + 10;

                // 随机速度 (px/frame)
                // 速度范围：1 ~ 3
                const speed = 1.5; 
                const angle = Math.random() * Math.PI * 2;
                const dx = Math.cos(angle) * speed;
                const dy = Math.sin(angle) * speed;

                blocks.push({
                    el: el,
                    x: x,
                    y: y,
                    dx: dx,
                    dy: dy,
                    width: w,
                    height: h,
                    glowTimer: null,
                    isHovered: false // 新增状态
                });

                // 绑定鼠标事件
                el.addEventListener('mouseenter', () => {
                    const block = blocks[index]; // 闭包捕获
                    block.isHovered = true;
                    // 可选：悬停时暂停运动？或者只是跟随？
                    // 如果要暂停物理运动，可以在 animate 里判断
                });
                
                el.addEventListener('mouseleave', () => {
                     const block = blocks[index];
                     block.isHovered = false;
                });
            });
        }

        // 物理循环
        function animate() {
            const containerRect = playground.getBoundingClientRect();
            const width = containerRect.width;
            const height = containerRect.height;

            blocks.forEach(block => {
                // 更新位置
                block.x += block.dx;
                block.y += block.dy;

                let hit = false;

                // 边界碰撞检测
                // 左边界
                if (block.x <= 0) {
                    block.x = 0;
                    block.dx = -block.dx;
                    hit = true;
                }
                // 右边界
                else if (block.x + block.width >= width) {
                    block.x = width - block.width;
                    block.dx = -block.dx;
                    hit = true;
                }

                // 上边界
                if (block.y <= 0) {
                    block.y = 0;
                    block.dy = -block.dy;
                    hit = true;
                }
                // 下边界
                else if (block.y + block.height >= height) {
                    block.y = height - block.height;
                    block.dy = -block.dy;
                    hit = true;
                }

                // 触发碰撞效果
                if (hit) {
                    triggerGlow(block);
                }

                // 应用位置
                // 使用 transform 比 top/left 性能更好
                block.el.style.transform = `translate(${block.x}px, ${block.y}px)`;
            });

            requestAnimationFrame(animate);
        }

        // 触发发光效果
        function triggerGlow(block) {
            block.el.classList.add('hit-glow');
            
            // 如果已有定时器，清除它（重置发光时间）
            if (block.glowTimer) {
                clearTimeout(block.glowTimer);
            }

            // 300ms 后移除发光
            block.glowTimer = setTimeout(() => {
                block.el.classList.remove('hit-glow');
                block.glowTimer = null;
            }, 300);
        }

        // 窗口大小改变时重置边界防止溢出
        window.addEventListener('resize', () => {
            const containerRect = playground.getBoundingClientRect();
            blocks.forEach(block => {
                if (block.x > containerRect.width - block.width) block.x = containerRect.width - block.width;
                if (block.y > containerRect.height - block.height) block.y = containerRect.height - block.height;
            });
        });

        // 启动
        // 稍微延迟确保布局完成
        setTimeout(() => {
            initBlocks();
            animate();
        }, 100);

    </script>
    <!-- 复用主页的彩蛋逻辑 -->
    <script src="../easterEgg.js"></script>
</body>
</html>